{% load markdown %}
{% load humanize %}
{% load future %}
<div id="search-results">
  {% for result in highlighted_results %}
    <div class="govuk-grid-row">
      <div class="govuk-grid-column-full">
        <h3 class="govuk-heading-m govuk-!-margin-bottom-2">
          {% with result_type=result.result_type.name|lower %}
            <a href="{% url 'home:details' result_type=result_type urn=result.urn %}" class="govuk-link">{{result.fully_qualified_name}}</a>
          {% endwith %}
          {% if result.result_type.name == "TABLE" %}
            <strong class="govuk-tag govuk-!-margin-left-2">
              Table
            </strong>
          {% elif result.result_type.name == "DATABASE" %}
            <strong class="govuk-tag govuk-!-margin-left-2">
              Database
            </strong>
          {% elif result.result_type.name == "CHART" %}
            <strong class="govuk-tag govuk-!-margin-left-2">
              Chart
            </strong>
          {% endif %}
        </h3>
        {% if result.description %}
          <div class="govuk-body-m">
            {{ result.description|truncate_snippet:300|markdown:3 }}
          </div>
        {% endif %}
        <dl class="govuk-summary-list govuk-summary-list--no-border">
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">Refresh period:</dt>
            <dd class="govuk-summary-list__value">
              TBC
            </dd>
          </div>
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">Domain:</dt>
            <dd class="govuk-summary-list__value">
              {{result.metadata.domain_name}}
            </dd>
          </div>
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key">Tags:</dt>
            <dd class="govuk-summary-list__value">
              {% if result.tags_to_display %}
                {% for tag in result.tags_to_display %}
                  <a aria-label="link to search results for all entities tagged {{ tag }}" href="{% url 'home:search' %}{% query_string clear_label=None clear_filter=None new=None tags=tag %}">{{ tag }}</a>{% if not forloop.last %}, {% endif %}
                {% endfor %}
              {% endif %}
            </dd>
          </div>
          {% if result.matches %}
            <div class="govuk-summary-list__row">
              <dt class="govuk-summary-list__key">Matched fields:</dt>
              <dd class="govuk-summary-list__value">
                {{ result.matches|lookup:readable_match_reasons|join:", " }}
              </dd>
            </div>
          {% endif %}
        </dl>
        <hr class="govuk-section-break govuk-section-break--m govuk-section-break--visible">
      </div>
    </div>
  {%endfor%}
</div>
